
\documentclass{article}

\begin{document}

\title{Tutorial for Phase Estimation}
\author{Rhys Hawkins}
\maketitle

\section{Overview}

This tutorial provides a worked example for estimating phase and group dispersion
from ambient noise cross-correlations using the method described in

\begin{flushleft}
  Hawkins R. and Sambridge M., ``An adjoint technique for estimation of interstation phase and
  group dispersion from ambient noise cross-correlations``, BSSA, 2019
\end{flushleft}

Within this directory, there are bash scripts to run an example inversion of a ambient noise
cross-correlation to obtain path average dispersion/models. The main steps for this inversions
are

\begin{enumerate}
\item Create a reference model and dispersion curve
\item Estimate points along the phase velocity dispersion curve from peaks, troughs, and zero-crossings
  of the Noise Correlation Function.
\item Fit a 1D Path Average Earth model to the trial dispersion curves
\item Fit a 1D Path Average Earth model and amplitude model to the Noise Correlation function
\end{enumerate}

\subsection{Quick run}

Each of these steps has a corresponding bash script for running the various stages of
the inversion process, to perform an inversion of one of the example noise correlation functions,
from within this directory, once the various prerequisites are installed and programs within
this software package are compiled, you can run in order:

\begin{verbatim}
> 00_create_reference.sh
> 01_create_initial_target_phase.sh
> 02_fit_initial_target_phase.sh
> 03_fit_bessel.sh
> python2 scripts/plot_bessel_result.py -f Final_HOT05_HOT25
\end{verbatim}

The first of these will generally only need to be run once, whereas the final three
are required for each station pair. These final three steps take approximately
6 minutes to run on a laptop computer. These scripts run command line programs which
are explained in further detail in the following sections.

\section{Creating a reference model}

A reference model is required as a starting point for this inversion process. The file format used
to describe the reference model is a simple text file, a simple example

\begin{verbatim}
2
10.0 0 3.50
0.0 0 4.80
\end{verbatim}

\section{Creating initial phase dispersion curves}

This inversion methodology uses an extension to previous methods for zero-crossing to include peaks and
troughs in addition to treating Love and Rayleigh observations jointly. This phase of the inversion is
implemented in a Python script {\texttt InitialPhase/scripts/estimate\_joint\_phase\_amplitude.py}. This script
assumes that the input files are arranged into directories and files as follows

\begin{verbatim}
BaseDirectory
  |
  |- LoveResponse
  |  |
  |  |- dispersion_<stationA>_<stationB>.txt
  |  |- ...
  |
  |- RayleighResponse
     |
     |- dispersion_<stationA>_<stationB>.txt
     |- ...
\end{verbatim}

This layout is used in the {\texttt example\_data} directory. This directory layout facilitates running the
{\texttt InitialPhase/scripts/estimate\_joint\_phase\_amplitude.py} script by specifying the base path
and a station pair to process. For example

\begin{verbatim}
python2 ../InitialPhase/scripts/estimate_joint_phase_amplitude.py -p ../example_data -s HOT05_HOT25 
\end{verbatim}

This will predict an initial phase dispersion curve for Love and Rayleigh dispersion based on picking
the peaks, troughs and zero crossings of the noise correlation function. As run above, this script
uses by default the reference models in the tutorial subdirectory and plots the result of the picking
and the phase dispersion curves for Love and Rayleigh waves. The important options for this script
are

\begin{description}
\item[-p|--path] The base path for the dispresion data files
\item[-s|--station-pair] The station pair, eg HOT05\_HOT25, to invert
\item[-f|--freq-min] Minimum frequency (Hz)
\item[-F|--freq-max] Maximum frequency (Hz)
\item[--filter] Gaussian filter width for smoothing Bessel functions (0 = no filtering)
\item[--noshow] Don't show the plots (useful for background processing)
\item[-o|--output] Output the trial dispersion curves to files (write two files with .love and .rayleigh suffixes)
\end{description}

The frequency min and max values specify the range of frequencies to
consider when searching for peaks, troughs, and zero-crossings
(default is 0.025 to 0.35 Hz). A tunable parameter is the filter width
that can be used to smooth NCF Bessel functions, values between 0 and
3 produce consistent results but this may need to be adjusted. By
default, the script simply shows a plot but with the noshow and output
options, the trial dispersion curves for Love and Rayleigh waves can
be written to files without plot output which is useful for bulk
processing of data.

\section{Fitting an Earth model to trial dispersion curves}



\section{Fitting}

  \appendix
  
\section{Input File Format}

The file format used by the programs here for observed ambient noise
cross-correlations is a simple text file format with some meta
information on the first two lines, followed by the noise correlation
function and empirical Greens function in the frequency domain.  An
example for the first 4 lines of one of the example data files is
shown below (these files are located in the example\_data
subdirectory).

\begin{verbatim}
  -21.09639    65.10969   -16.65020    65.05438   209.15596
  2.000000 197 11.33283 6.21773 4097
  0.000000 2.14409e-02  0.00000e+00  1.94272e-03  0.00000e+00
  0.000244 2.13633e-02 -2.33984e-06  1.33636e-02  7.39238e-04
\end{verbatim}

The first line contains longitude and latitude of the two stations,
i.e. <lonA> <latA> <lonB> <latB>, followed by the interstation
distance in kilometres. The second line contains the sampling rate of
the signal in Hertz, the number of days of cross-correlations, the
signal to noise ratios for the acausal and causal signals, and finally
the number of points in the frequency domain representation of the
noise correlation functions.

The remaining lines contains the frequency domain representations of
the empirical Greens functions and noise correlation functions where
each line consists of <frequency>, <real EGF> <imaginary EGF> <real
NCF> <imaginary NCF>. The frequency domain representation is assumed
to be of a real signal and hence only the positive frequencies are
required.

For this inversion approach, the important parts of the data file
required are the interstation distance, the sampling rate and the
first and forth column (frequency and real component of the NCF). The
EGF columns are only used for comparing Group velocity predictions.


\end{document}

